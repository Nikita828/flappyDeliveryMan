// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É Phaser –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã
import Phaser from "phaser";

// –®–∏—Ä–∏–Ω–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è –≤ –ø–∏–∫—Å–µ–ª—è—Ö
const WIDTH = 360;
// –í—ã—Å–æ—Ç–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è –≤ –ø–∏–∫—Å–µ–ª—è—Ö
const HEIGHT = 640;
// –í—ã—Å–æ—Ç–∞ –ø–æ–ª–æ—Å–∫–∏ –∑–µ–º–ª–∏ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞
const GROUND_H = 80;

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∏–≥—Ä–æ–≤–æ–π —Å—Ü–µ–Ω—ã ‚Äî –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç Phaser.Scene
class GameScene extends Phaser.Scene {
  // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Å—Ü–µ–Ω—ã
  constructor() {
    // –ü–µ—Ä–µ–¥–∞—ë–º —Ä–æ–¥–∏—Ç–µ–ª—é —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á —Å—Ü–µ–Ω—ã "game"
    super("game");
  }

  // init() ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ü–ï–†–í–´–ú –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å—Ü–µ–Ω—ã
  // –ó–¥–µ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  init() {
    // –ó–∞–ø–∞—Å –≤ –ø–∏–∫—Å–µ–ª—è—Ö —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É —â–µ–ª–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ö–∏—Ç–±–æ–∫—Å–∞ –ø—Ç–∏—Ü—ã
    // –ß—Ç–æ–±—ã –ø—Ç–∏—Ü–∞ –Ω–µ –≤–ø—Ä–∏—Ç—ã–∫ –ø—Ä–æ–ª–µ—Ç–∞–ª–∞
    this.gapPadding = 22;

    // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã:
    // "idle"     ‚Äî –∂–¥—ë–º –ø–µ—Ä–≤–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
    // "play"     ‚Äî –∏–≥—Ä–∞ –∏–¥—ë—Ç
    // "gameover" ‚Äî –∏–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª
    this.state = "idle";

    // –¢–µ–∫—É—â–∏–π —Å—á—ë—Ç –∏–≥—Ä–æ–∫–∞ (—Å–∫–æ–ª—å–∫–æ –∑–¥–∞–Ω–∏–π –ø—Ä–æ–ª–µ—Ç–µ–ª)
    this.score = 0;

    // –°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –∑–¥–∞–Ω–∏–π —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ (–ø–∏–∫—Å–µ–ª–µ–π –≤ —Å–µ–∫—É–Ω–¥—É)
    this.scrollSpeed = 170;

    // –†–∞–∑–º–µ—Ä —â–µ–ª–∏ (–ø—Ä–æ—Å–≤–µ—Ç–∞) –º–µ–∂–¥—É –≤–µ—Ä—Ö–Ω–∏–º –∏ –Ω–∏–∂–Ω–∏–º –∑–¥–∞–Ω–∏–µ–º
    this.pipeGap = 170;

    // –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ—è–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –ø–∞—Ä –∑–¥–∞–Ω–∏–π (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
    this.spawnInterval = 1400;

    // –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–π–º–µ—Ä —Å–ø–∞–≤–Ω–∞ ‚Äî –Ω—É–∂–Ω–∞ —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
    this.spawnTimer = null;

    // –¶–µ–Ω—Ç—Ä –ø—Ä–µ–¥—ã–¥—É—â–µ–π —â–µ–ª–∏ –ø–æ Y ‚Äî –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤—ã—Å–æ—Ç
    // –ù–∞—á–∏–Ω–∞–µ–º —Å —Å–µ—Ä–µ–¥–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞
    this.lastGapCenter = HEIGHT / 2;

    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–¥–≤–∏–≥ —Ü–µ–Ω—Ç—Ä–∞ —â–µ–ª–∏ –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ –ø–∞—Ä–∞–º–∏ –∑–¥–∞–Ω–∏–π
    // –ß–µ–º –º–µ–Ω—å—à–µ ‚Äî —Ç–µ–º –ø–ª–∞–≤–Ω–µ–µ –ø–µ—Ä–µ—Ö–æ–¥—ã (–ª–µ–≥—á–µ –∏–≥—Ä–∞—Ç—å)
    this.maxGapShift = 120;

    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∫–æ—Ä–¥ –∏–∑ localStorage –±—Ä–∞—É–∑–µ—Ä–∞
    const saved = localStorage.getItem("flappy-best");
    // –ï—Å–ª–∏ —Ä–µ–∫–æ—Ä–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω ‚Äî –ø–∞—Ä—Å–∏–º —á–∏—Å–ª–æ, –∏–Ω–∞—á–µ —Å—Ç–∞–≤–∏–º 0
    this.bestScore = saved ? parseInt(saved, 10) : 0;

    // –ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –∑–¥–∞–Ω–∏–π ‚Äî –∫–∞–∂–¥–∞—è –ø–∞—Ä–∞ –ø–æ–ª—É—á–∏—Ç —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç
    this.buildingColors = [
      0x8b5e3c, // –∫–æ—Ä–∏—á–Ω–µ–≤—ã–π
      0xa0522d, // —Å–∏–µ–Ω–∞ (–∫—Ä–∞—Å–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π)
      0x6b7b8d, // —Å–µ—Ä–æ-–≥–æ–ª—É–±–æ–π
      0x7a6655, // —Ç—ë–ø–ª—ã–π —Å–µ—Ä—ã–π
      0x9b7653, // –ø–µ—Å–æ—á–Ω—ã–π
      0x5f7a8a, // —Å—Ç–∞–ª—å–Ω–æ–π —Å–∏–Ω–∏–π
      0x8b7d6b, // –±–µ–∂–µ–≤—ã–π
      0x6a5f50, // —Ç—ë–º–Ω–æ-–±–µ–∂–µ–≤—ã–π
    ];
  }

  // preload() ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (–∫–∞—Ä—Ç–∏–Ω–æ–∫, –∑–≤—É–∫–æ–≤) –î–û —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
  // Phaser –∂–¥—ë—Ç –ø–æ–∫–∞ –≤—Å—ë –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, –ø–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞–µ—Ç create()
  preload() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –ø—Ç–∏—á–∫–∏ –∏–∑ –ø–∞–ø–∫–∏ public/assets/
    // "bird" ‚Äî –∫–ª—é—á, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –ø–æ—Ç–æ–º –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ
    this.load.image("bird", "assets/bird.png");
  }

  // create() ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
  // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
  create() {

     // ========================================
    // === –¢–ï–ö–°–¢–£–†–ê 1x1 –ë–ï–õ–´–ô –ü–ò–ö–°–ï–õ–¨      ===
    // ========================================

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º ‚Äî –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç—É—Ä–∞ "px" –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
    if (!this.textures.exists("px")) {
      // –°–æ–∑–¥–∞—ë–º –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç (add: false ‚Äî –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ü–µ–Ω—É)
      const g = this.make.graphics({ x: 0, y: 0, add: false });
      // –ó–∞–ª–∏–≤–∞–µ–º –±–µ–ª—ã–º —Ü–≤–µ—Ç–æ–º —Å –ø–æ–ª–Ω–æ–π –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
      g.fillStyle(0xffffff, 1);
      // –†–∏—Å—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç 1x1 –ø–∏–∫—Å–µ–ª—å
      g.fillRect(0, 0, 1, 1);
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç—É—Ä—É —Å –∫–ª—é—á–æ–º "px"
      // –ü–æ—Ç–æ–º —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∏ –∫—Ä–∞—Å–∏–º ‚Äî –ø–æ–ª—É—á–∞–µ–º –ª—é–±–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
      g.generateTexture("px", 1, 1);
      // –£–¥–∞–ª—è–µ–º –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç ‚Äî —Ç–µ–∫—Å—Ç—É—Ä–∞ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
      g.destroy();
    }
    // ========================================
    // === –ì–†–ê–î–ò–ï–ù–¢–ù–û–ï –ù–ï–ë–û (—Ñ–æ–Ω)           ===
    // ========================================

    // –°–æ–∑–¥–∞—ë–º –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–µ–±–∞
    const skyGraphics = this.add.graphics();
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–æ—Å –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
    const skySteps = 20;
    // –í—ã—Å–æ—Ç–∞ –∫–∞–∂–¥–æ–π –ø–æ–ª–æ—Å—ã = –≤—ã—Å–æ—Ç–∞ –Ω–µ–±–∞ / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–æ—Å
    const stepH = (HEIGHT - GROUND_H) / skySteps;

    // –†–∏—Å—É–µ–º –ø–æ–ª–æ—Å—ã –æ—Ç –≤–µ—Ä—Ö–∞ –∫ –Ω–∏–∑—É, –∫–∞–∂–¥–∞—è —á—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π
    for (let i = 0; i < skySteps; i++) {
      // t ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç 0 (–≤–µ—Ä—Ö) –¥–æ 1 (–Ω–∏–∑)
      const t = i / skySteps;
      // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ü–≤–µ—Ç–∞ —Å –ø–ª–∞–≤–Ω—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º
      const r = Math.round(100 + t * 75);  // –∫—Ä–∞—Å–Ω—ã–π: 100 ‚Üí 175
      const g = Math.round(170 + t * 55);  // –∑–µ–ª—ë–Ω—ã–π: 170 ‚Üí 225
      const b = Math.round(230 + t * 25);  // —Å–∏–Ω–∏–π:   230 ‚Üí 255
      // –°–æ–±–∏—Ä–∞–µ–º RGB –≤ –æ–¥–Ω–æ —á–∏—Å–ª–æ (—Ñ–æ—Ä–º–∞—Ç 0xRRGGBB)
      const color = (r << 16) | (g << 8) | b;

      // –ó–∞–ª–∏–≤–∞–µ–º –ø–æ–ª–æ—Å—É –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–º —Ü–≤–µ—Ç–æ–º
      skyGraphics.fillStyle(color, 1);
      // –†–∏—Å—É–µ–º –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (x, y, —à–∏—Ä–∏–Ω–∞, –≤—ã—Å–æ—Ç–∞)
      // +1 –∫ –≤—ã—Å–æ—Ç–µ —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —â–µ–ª–µ–π –º–µ–∂–¥—É –ø–æ–ª–æ—Å–∞–º–∏
      skyGraphics.fillRect(0, i * stepH, WIDTH, stepH + 1);
    }
    // –°—Ç–∞–≤–∏–º –Ω–µ–±–æ –Ω–∞ —Å–∞–º—ã–π –Ω–∏–∂–Ω–∏–π —Å–ª–æ–π
    skyGraphics.setDepth(0);

    // ========================================
    // === –û–ë–õ–ê–ö–ê                           ===
    // ========================================

    // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ–±–ª–∞–∫–æ–≤
    this.clouds = [];
    // –°–æ–∑–¥–∞—ë–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±–ª–∞–∫–æ–≤
    this.createClouds();

   

    // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º Y-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫—Ä–∞—è –∑–µ–º–ª–∏
    // –í—Å—ë —á—Ç–æ –Ω–∏–∂–µ ‚Äî —ç—Ç–æ –∑–µ–º–ª—è
    this.groundTop = HEIGHT - GROUND_H;

    // ========================================
    // === –ó–ï–ú–õ–Ø (—Ç—Ä–∏ —Å–ª–æ—è)                 ===
    // ========================================

    // –û—Å–Ω–æ–≤–Ω–æ–π —Å–ª–æ–π –∑–µ–º–ª–∏ ‚Äî —Ç—ë–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π
    this.add
      .image(WIDTH / 2, HEIGHT - GROUND_H / 2, "px") // —Ü–µ–Ω—Ç—Ä –∑–µ–º–ª–∏
      .setTint(0x5a4a3a) // —Ç—ë–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ü–≤–µ—Ç
      .setDisplaySize(WIDTH, GROUND_H) // —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É
      .setDepth(5); // —Å–ª–æ–π 5 ‚Äî –ø–æ–≤–µ—Ä—Ö –∑–¥–∞–Ω–∏–π

    // –ü–æ–ª–æ—Å–∫–∞ —Ç—Ä–∞–≤—ã ‚Äî —è—Ä–∫–æ-–∑–µ–ª—ë–Ω–∞—è, 8px –≤—ã—Å–æ—Ç–æ–π
    this.add
      .image(WIDTH / 2, this.groundTop + 4, "px") // —á—É—Ç—å –Ω–∏–∂–µ –≤–µ—Ä—Ö–∞ –∑–µ–º–ª–∏
      .setTint(0x4caf50) // –∑–µ–ª—ë–Ω—ã–π
      .setDisplaySize(WIDTH, 8) // —Ç–æ–Ω–∫–∞—è –ø–æ–ª–æ—Å–∫–∞
      .setDepth(6); // –ø–æ–≤–µ—Ä—Ö –æ—Å–Ω–æ–≤–Ω–æ–π –∑–µ–º–ª–∏

    // –¢—ë–º–Ω–∞—è –ª–∏–Ω–∏—è –ø–æ–¥ —Ç—Ä–∞–≤–æ–π ‚Äî –¥–ª—è –æ–±—ä—ë–º–∞
    this.add
      .image(WIDTH / 2, this.groundTop + 9, "px") // –µ—â—ë —á—É—Ç—å –Ω–∏–∂–µ
      .setTint(0x388e3c) // —Ç—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π
      .setDisplaySize(WIDTH, 3) // –æ—á–µ–Ω—å —Ç–æ–Ω–∫–∞—è
      .setDepth(6);

    // –°–ª—É—á–∞–π–Ω—ã–µ —Ç–æ—á–∫–∏ –Ω–∞ –∑–µ–º–ª–µ ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è –∫–∞–º–µ—à–∫–æ–≤/—Ç–µ–∫—Å—Ç—É—Ä—ã
    for (let i = 0; i < 15; i++) {
      // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è X –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É
      const dx = Phaser.Math.Between(10, WIDTH - 10);
      // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è Y –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∑–µ–º–ª–∏
      const dy = Phaser.Math.Between(this.groundTop + 15, HEIGHT - 10);
      this.add
        .image(dx, dy, "px")
        .setTint(0x4a3a2a) // —Ç—ë–º–Ω—ã–µ —Ç–æ—á–∫–∏
        .setDisplaySize(
          Phaser.Math.Between(2, 5), // —Å–ª—É—á–∞–π–Ω–∞—è —à–∏—Ä–∏–Ω–∞ 2-5px
          Phaser.Math.Between(2, 4)  // —Å–ª—É—á–∞–π–Ω–∞—è –≤—ã—Å–æ—Ç–∞ 2-4px
        )
        .setAlpha(0.4) // –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ
        .setDepth(6);
    }

    // ========================================
    // === –ò–ì–†–û–ö (–ü–¢–ò–ß–ö–ê)                   ===
    // ========================================

    // –°–æ–∑–¥–∞—ë–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Å–ø—Ä–∞–π—Ç —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π –ø—Ç–∏—á–∫–∏
    // physics.add.image ‚Äî –æ–±—ä–µ–∫—Ç —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º —Ç–µ–ª–æ–º (–¥–ª—è –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π)
    // 90 ‚Äî –ø–æ–∑–∏—Ü–∏—è X (–ª–µ–≤–∞—è —á–∞—Å—Ç—å —ç–∫—Ä–∞–Ω–∞)
    // HEIGHT / 3 ‚Äî –ø–æ–∑–∏—Ü–∏—è Y (–≤–µ—Ä—Ö–Ω—è—è —Ç—Ä–µ—Ç—å —ç–∫—Ä–∞–Ω–∞)
    this.player = this.physics.add.image(90, HEIGHT / 3, "bird");
    // –í–∏–¥–∏–º—ã–π —Ä–∞–∑–º–µ—Ä –ø—Ç–∏—á–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ (–º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏)
    this.player.setDisplaySize(110, 70);
    // –°–ª–æ–π 10 ‚Äî –ø—Ç–∏—á–∫–∞ –ø–æ–≤–µ—Ä—Ö –∑–µ–º–ª–∏ –∏ –∑–¥–∞–Ω–∏–π
    this.player.setDepth(10);
    // –û—Ç–∫–ª—é—á–∞–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é –¥–æ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã ‚Äî –ø—Ç–∏—á–∫–∞ –≤–∏—Å–∏—Ç –Ω–∞ –º–µ—Å—Ç–µ
    this.player.body.setAllowGravity(false);

    // –†–∞–∑–º–µ—Ä —Ö–∏—Ç–±–æ–∫—Å–∞ (–∑–æ–Ω–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π) ‚Äî –ú–ï–ù–¨–®–ï —á–µ–º –≤–∏–¥–∏–º–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
    // –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∏–≥—Ä—É "—á–µ—Å—Ç–Ω–µ–µ" ‚Äî —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∫–∞—Å–∞–Ω–∏–∏
    this.player.body.setSize(50, 36);

    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å –≤–Ω—É—Ç—Ä–∏ –≤–∏–¥–∏–º–æ–≥–æ —Å–ø—Ä–∞–π—Ç–∞
    // –ë–µ–∑ —ç—Ç–æ–≥–æ —Ö–∏—Ç–±–æ–∫—Å –±—ã–ª –±—ã –≤ —É–≥–ª—É –∫–∞—Ä—Ç–∏–Ω–∫–∏
    this.player.body.setOffset(
      (this.player.width - this.player.body.width) / 2,   // —Å–¥–≤–∏–≥ –ø–æ X –∫ —Ü–µ–Ω—Ç—Ä—É
      (this.player.height - this.player.body.height) / 2   // —Å–¥–≤–∏–≥ –ø–æ Y –∫ —Ü–µ–Ω—Ç—Ä—É
    );

    // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –±–∞–∑–æ–≤—ã–π –º–∞—Å—à—Ç–∞–± –ü–û–°–õ–ï setDisplaySize
    // –ù—É–∂–Ω–æ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä—ã–∂–∫–∞ ‚Äî —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å –∫ –∫–∞–∫–æ–º—É —Ä–∞–∑–º–µ—Ä—É –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è
    this.playerBaseScaleX = this.player.scaleX;
    this.playerBaseScaleY = this.player.scaleY;

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏—è –ø—Ç–∏—á–∫–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ
    // –ü–ª–∞–≤–Ω–æ –¥–≤–∏–≥–∞–µ—Ç –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑ –ø–æ–∫–∞ –∏–≥—Ä–æ–∫ –Ω–µ –Ω–∞–∂–º—ë—Ç
    this.idleTween = this.tweens.add({
      targets: this.player,        // —á—Ç–æ –∞–Ω–∏–º–∏—Ä—É–µ–º
      y: this.player.y - 15,       // –¥–≤–∏–≥–∞–µ–º –Ω–∞ 15px –≤–≤–µ—Ä—Ö
      duration: 600,               // –∑–∞ 600 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
      yoyo: true,                  // –ø–æ—Ç–æ–º –æ–±—Ä–∞—Ç–Ω–æ –≤–Ω–∏–∑
      repeat: -1,                  // –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
      ease: "Sine.easeInOut",      // –ø–ª–∞–≤–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ/–∑–∞–º–µ–¥–ª–µ–Ω–∏–µ
    });

    // –¢–µ–Ω—å –ø–æ–¥ –ø—Ç–∏—á–∫–æ–π ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–π —Ç—ë–º–Ω—ã–π –æ–≤–∞–ª –Ω–∞ –∑–µ–º–ª–µ
    this.playerShadow = this.add
      .image(90, this.groundTop - 5, "px") // —á—É—Ç—å –≤—ã—à–µ –∑–µ–º–ª–∏
      .setTint(0x000000) // —á—ë—Ä–Ω–∞—è
      .setDisplaySize(40, 8) // –º–∞–ª–µ–Ω—å–∫–∏–π –æ–≤–∞–ª
      .setAlpha(0.15) // –ø–æ—á—Ç–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è
      .setDepth(4); // –ø–æ–¥ –∑–µ–º–ª—ë–π –Ω–æ –Ω–∞–¥ —Ñ–æ–Ω–æ–º

    // ========================================
    // === –ú–ê–°–°–ò–í –ú–ê–†–ö–ï–†–û–í –ó–î–ê–ù–ò–ô           ===
    // ========================================

    // –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤-–º–∞—Ä–∫–µ—Ä–æ–≤ ‚Äî –∫–∞–∂–¥—ã–π –º–∞—Ä–∫–µ—Ä —Ö—Ä–∞–Ω–∏—Ç –ø–æ–∑–∏—Ü–∏—é,
    // —Ä–∞–∑–º–µ—Ä –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤—Å–µ —á–∞—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ –∑–¥–∞–Ω–∏—è
    this.pipeMarkers = [];

    // ========================================
    // === –¢–ï–ö–°–¢ –°–ß–Å–¢–ê (–≤–≤–µ—Ä—Ö—É –ø–æ —Ü–µ–Ω—Ç—Ä—É)   ===
    // ========================================

    this.scoreText = this.add
      .text(WIDTH / 2, 40, "0", {
        fontFamily: "Arial",      // —à—Ä–∏—Ñ—Ç
        fontSize: "44px",         // —Ä–∞–∑–º–µ—Ä ‚Äî –∫—Ä—É–ø–Ω—ã–π
        color: "#ffffff",         // –±–µ–ª—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
        fontStyle: "bold",        // –∂–∏—Ä–Ω—ã–π
        stroke: "#2c3e50",        // —Ç—ë–º–Ω–∞—è –æ–±–≤–æ–¥–∫–∞
        strokeThickness: 5,       // —Ç–æ–ª—â–∏–Ω–∞ –æ–±–≤–æ–¥–∫–∏
        shadow: {                 // —Ç–µ–Ω—å –¥–ª—è –æ–±—ä—ë–º–∞
          offsetX: 2,             // —Å–¥–≤–∏–≥ —Ç–µ–Ω–∏ –≤–ø—Ä–∞–≤–æ
          offsetY: 2,             // —Å–¥–≤–∏–≥ —Ç–µ–Ω–∏ –≤–Ω–∏–∑
          color: "#00000044",     // –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è —á—ë—Ä–Ω–∞—è
          blur: 4,                // —Ä–∞–∑–º—ã—Ç–∏–µ —Ç–µ–Ω–∏
          fill: true,             // –∑–∞–ª–∏–≤–∞—Ç—å —Ç–µ–Ω—å
        },
      })
      .setOrigin(0.5)  // —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø–æ –µ–≥–æ —Å–µ—Ä–µ–¥–∏–Ω–µ
      .setDepth(100);  // —Å–ª–æ–π 100 ‚Äî –ø–æ–≤–µ—Ä—Ö –≤—Å–µ—Ö –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

    // ========================================
    // === –¢–ï–ö–°–¢ –†–ï–ö–û–†–î–ê (–ø–æ–¥ —Å—á—ë—Ç–æ–º)       ===
    // ========================================

    this.bestText = this.add
      .text(WIDTH / 2, 78, "–†–µ–∫–æ—Ä–¥: " + this.bestScore, {
        fontFamily: "Arial",
        fontSize: "16px",         // –º–µ–ª–∫–∏–π —Ç–µ–∫—Å—Ç
        color: "#ffffffcc",       // –±–µ–ª—ã–π —Å –ª—ë–≥–∫–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
        stroke: "#00000066",      // –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –æ–±–≤–æ–¥–∫–∞
        strokeThickness: 2,
      })
      .setOrigin(0.5)
      .setDepth(100);

    // ========================================
    // === –ü–û–î–°–ö–ê–ó–ö–ê (—Ü–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞)         ===
    // ========================================

    this.hintText = this.add
      .text(WIDTH / 2, HEIGHT / 2 + 80, "–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å", {
        fontFamily: "Arial",
        fontSize: "22px",
        color: "#ffffff",
        stroke: "#00000",
        strokeThickness: 3,
      })
      .setOrigin(0.5)
      .setDepth(100);

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ ‚Äî –º–∏–≥–∞–µ—Ç —á—Ç–æ–±—ã –ø—Ä–∏–≤–ª–µ—á—å –≤–Ω–∏–º–∞–Ω–∏–µ
    this.tweens.add({
      targets: this.hintText,
      alpha: 0.4,                // —É–º–µ–Ω—å—à–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–æ 40%
      duration: 800,             // –∑–∞ 800–º—Å
      yoyo: true,                // –ø–æ—Ç–æ–º –æ–±—Ä–∞—Ç–Ω–æ –∫ 100%
      repeat: -1,                // –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
      ease: "Sine.easeInOut",
    });

    // ========================================
    // === –ü–ê–ù–ï–õ–¨ GAME OVER                 ===
    // ========================================

    // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤
    // –í—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –æ–±—ä–µ–∫—Ç—ã –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è –û–¢–ù–û–°–ò–¢–ï–õ–¨–ù–û –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    this.gameOverPanel = this.add
      .container(WIDTH / 2, HEIGHT / 2) // —Ü–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞
      .setDepth(200); // —Å–∞–º—ã–π –≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π
    // –ü—Ä—è—á–µ–º –¥–æ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
    this.gameOverPanel.setVisible(false);

    // –§–æ–Ω –ø–∞–Ω–µ–ª–∏ ‚Äî —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
    const panelGraphics = this.add.graphics();
    // –ó–∞–ª–∏–≤–∫–∞: —Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π, 85% –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
    panelGraphics.fillStyle(0x1a1a2e, 0.85);
    // –°–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (x, y, —à–∏—Ä–∏–Ω–∞, –≤—ã—Å–æ—Ç–∞, —Ä–∞–¥–∏—É—Å —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è)
    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (0,0 = —Ü–µ–Ω—Ç—Ä –ø–∞–Ω–µ–ª–∏)
    panelGraphics.fillRoundedRect(-145, -110, 290, 220, 16);
    // –¢–æ–Ω–∫–∞—è –±–µ–ª–∞—è —Ä–∞–º–∫–∞
    panelGraphics.lineStyle(2, 0xffffff, 0.2);
    panelGraphics.strokeRoundedRect(-145, -110, 290, 220, 16);

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–ö–û–ù–ï–¶ –ò–ì–†–´" ‚Äî –∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç
    const goTitle = this.add
      .text(0, -75, "–ö–û–ù–ï–¶ –ò–ì–†–´", {
        fontFamily: "Arial",
        fontSize: "30px",
        color: "#ff6b6b",         // –º—è–≥–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π
        fontStyle: "bold",
        stroke: "#000000",
        strokeThickness: 3,
      })
      .setOrigin(0.5);

    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º
    const divider = this.add.graphics();
    divider.lineStyle(1, 0xffffff, 0.2); // —Ç–æ–Ω–∫–∞—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –±–µ–ª–∞—è
    divider.lineBetween(-100, -48, 100, -48); // –æ—Ç (-100,-48) –¥–æ (100,-48)

    // –¢–µ–∫—Å—Ç —Å—á—ë—Ç–∞ –Ω–∞ –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
    this.panelScoreText = this.add
      .text(0, -25, "", {
        fontFamily: "Arial",
        fontSize: "22px",
        color: "#ffffff",
        stroke: "#000000",
        strokeThickness: 2,
      })
      .setOrigin(0.5);

    // –¢–µ–∫—Å—Ç —Ä–µ–∫–æ—Ä–¥–∞ –Ω–∞ –ø–∞–Ω–µ–ª–∏ ‚Äî –∑–æ–ª–æ—Ç–æ–π —Ü–≤–µ—Ç
    this.panelBestText = this.add
      .text(0, 10, "", {
        fontFamily: "Arial",
        fontSize: "22px",
        color: "#ffd93d",         // –∑–æ–ª–æ—Ç–æ–π
        stroke: "#000000",
        strokeThickness: 2,
      })
      .setOrigin(0.5);

    // –¢–µ–∫—Å—Ç "–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!" ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–±–∏—Ç–∏–∏
    this.newRecordText = this.add
      .text(0, 50, "‚≠ê –ù–û–í–´–ô –†–ï–ö–û–†–î! ‚≠ê", {
        fontFamily: "Arial",
        fontSize: "18px",
        color: "#ffd93d",
        fontStyle: "bold",
        stroke: "#000000",
        strokeThickness: 2,
      })
      .setOrigin(0.5);

    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–Ω–µ–ª–∏
    this.gameOverPanel.add([
      panelGraphics,        // —Ñ–æ–Ω
      goTitle,              // –∑–∞–≥–æ–ª–æ–≤–æ–∫
      divider,              // —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
      this.panelScoreText,  // —Å—á—ë—Ç
      this.panelBestText,   // —Ä–µ–∫–æ—Ä–¥
      this.newRecordText,   // –Ω–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥
    ]);

    // ========================================
    // === –û–ë–†–ê–ë–û–¢–ö–ê –ù–ê–ñ–ê–¢–ò–ô                ===
    // ========================================

    // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –Ω–∞–∂–∞—Ç–∏—è/–∫–ª–∏–∫–∞ –ø–æ —ç–∫—Ä–∞–Ω—É
    // this ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç (—á—Ç–æ–±—ã –≤–Ω—É—Ç—Ä–∏ handleTap —Ä–∞–±–æ—Ç–∞–ª this)
    this.input.on("pointerdown", this.handleTap, this);

    

   // ========================================
// === –û–¢–õ–ê–î–û–ß–ù–´–ï –ö–û–ú–ê–ù–î–´ (DEV MODE)    ===
// ========================================

if (import.meta.env.MODE !== "production") {
  window.__scene = this;
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
  window.bot = {
    enabled: false,
  };
  
  // –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
 window.cheat = {
  godMode: () => {
    this.player.body.setSize(1, 1);
    console.log("üõ°Ô∏è God mode ON");
  },
  
  mortal: () => {
    this.player.body.setSize(50, 36);
    console.log("üíÄ God mode OFF");
  },
  
  addScore: (n = 10) => {
    for (let i = 0; i < n; i++) this.addScore();
    console.log(`+${n} –æ—á–∫–æ–≤, –≤—Å–µ–≥–æ: ${this.score}`);
  },
  
  setScore: (n) => {
    this.score = n;
    this.scoreText.setText(String(n));
    console.log(`–°—á—ë—Ç: ${n}`);
  },
  
  die: () => {
    this.die();
    console.log("üíÄ –°–º–µ—Ä—Ç—å");
  },
  
  speed: (v) => {
    this.scrollSpeed = v;
    console.log(`–°–∫–æ—Ä–æ—Å—Ç—å: ${v}`);
  },
  
  gap: (v) => {
    this.pipeGap = v;
    console.log(`–©–µ–ª—å: ${v}`);
  },
  
  pause: () => {
    this.scene.pause();
    console.log("‚è∏Ô∏è –ü–∞—É–∑–∞");
  },
  
  resume: () => {
    this.scene.resume();
    console.log("‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å");
  },
  
  // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô debug:
  debug: (on = true) => {
    if (on) {
      if (!this.physics.world.debugGraphic) {
        this.physics.world.createDebugGraphic();
      }
      this.physics.world.drawDebug = true;
      this.physics.world.debugGraphic.setVisible(true);
      this.physics.world.debugGraphic.setDepth(999);
    } else {
      this.physics.world.drawDebug = false;
      if (this.physics.world.debugGraphic) {
        this.physics.world.debugGraphic.setVisible(false);
      }
    }
    console.log(`üîç Debug: ${on}`);
  },
  
  tp: (x, y) => {
    this.player.setPosition(x, y);
    console.log(`–¢–µ–ª–µ–ø–æ—Ä—Ç: ${x}, ${y}`);
  },
  
  resetBest: () => {
    localStorage.removeItem("flappy-best");
    this.bestScore = 0;
    this.bestText.setText("–†–µ–∫–æ—Ä–¥: 0");
    console.log("üóëÔ∏è –†–µ–∫–æ—Ä–¥ —Å–±—Ä–æ—à–µ–Ω");
  },
  
  bot: (on = true) => {
    window.bot.enabled = on;
    console.log(on ? "ü§ñ –ë–æ—Ç ON" : "ü§ñ –ë–æ—Ç OFF");
  },
};
  
  console.log("üéÆ –ß–∏—Ç—ã: cheat.godMode(), cheat.addScore(10), cheat.bot(true), etc.");
}
  }

  // ========================================
  // === –°–û–ó–î–ê–ù–ò–ï –û–ë–õ–ê–ö–û–í                 ===
  // ========================================

  createClouds() {
    // –°–æ–∑–¥–∞—ë–º 5 –æ–±–ª–∞–∫–æ–≤ –≤ —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
    for (let i = 0; i < 5; i++) {
      const cloud = this.add
        .image(
          Phaser.Math.Between(0, WIDTH),           // —Å–ª—É—á–∞–π–Ω—ã–π X –ø–æ —à–∏—Ä–∏–Ω–µ
          Phaser.Math.Between(30, HEIGHT / 2 - 50), // —Å–ª—É—á–∞–π–Ω—ã–π Y –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–æ–ª–æ–≤–∏–Ω–µ
          "px" // –±–µ–ª—ã–π –ø–∏–∫—Å–µ–ª—å ‚Äî —Ä–∞—Å—Ç—è–Ω–µ–º –≤ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
        )
        .setTint(0xffffff) // –±–µ–ª—ã–π —Ü–≤–µ—Ç
        .setDisplaySize(
          Phaser.Math.Between(50, 100), // —Å–ª—É—á–∞–π–Ω–∞—è —à–∏—Ä–∏–Ω–∞ 50-100px
          Phaser.Math.Between(15, 30)   // —Å–ª—É—á–∞–π–Ω–∞—è –≤—ã—Å–æ—Ç–∞ 15-30px
        )
        .setAlpha(Phaser.Math.FloatBetween(0.2, 0.5)) // —Å–ª—É—á–∞–π–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
        .setDepth(1); // —á—É—Ç—å –≤—ã—à–µ –Ω–µ–±–∞, –Ω–∏–∂–µ –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –æ–±–ª–∞–∫–∞
      cloud.cloudSpeed = Phaser.Math.FloatBetween(8, 20);
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ update()
      this.clouds.push(cloud);
    }
  }

  // ========================================
  // === –û–ë–†–ê–ë–û–¢–ö–ê –ù–ê–ñ–ê–¢–ò–Ø –ù–ê –≠–ö–†–ê–ù       ===
  // ========================================

  handleTap() {
    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ "–æ–∂–∏–¥–∞–Ω–∏–µ" ‚Üí –Ω–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É ---
    if (this.state === "idle") {
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ "–∏–≥—Ä–∞–µ–º"
      this.state = "play";

      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏—è
      if (this.idleTween) {
        this.idleTween.stop();
        this.idleTween = null;
      }

      // –í–∫–ª—é—á–∞–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é ‚Äî –ø—Ç–∏—á–∫–∞ –Ω–∞—á–Ω—ë—Ç –ø–∞–¥–∞—Ç—å
      this.player.body.setAllowGravity(true);
      // –°–∏–ª–∞ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ (—á–µ–º –±–æ–ª—å—à–µ ‚Äî —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ –ø–∞–¥–∞–µ—Ç)
      this.player.body.setGravityY(900);
      // –ü–µ—Ä–≤—ã–π –ø—Ä—ã–∂–æ–∫ ‚Äî —Ç–æ–ª–∫–∞–µ–º –ø—Ç–∏—á–∫—É –≤–≤–µ—Ä—Ö
      // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –¥–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö
      this.player.body.setVelocityY(-330);
      // –ü—Ä—è—á–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
      this.hintText.setVisible(false);

      // –ß–µ—Ä–µ–∑ 1.2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞—á–∏–Ω–∞–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–¥–∞–Ω–∏—è
      // –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω—É–∂–Ω–∞ —á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ —É—Å–ø–µ–ª —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è
      this.time.delayedCall(1200, () => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏–≥—Ä–∞ –≤—Å—ë –µ—â—ë –∏–¥—ë—Ç (–≤–¥—Ä—É–≥ —É–∂–µ –ø—Ä–æ–∏–≥—Ä–∞–ª)
        if (this.state === "play") this.startSpawning();
      });
      return; // –≤—ã—Ö–æ–¥–∏–º ‚Äî –¥–∞–ª—å—à–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
    }

    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ "–∏–≥—Ä–∞–µ–º" ‚Üí –ø—Ä—ã–∂–æ–∫ ---
    if (this.state === "play") {
      // –¢–æ–ª–∫–∞–µ–º –ø—Ç–∏—á–∫—É –≤–≤–µ—Ä—Ö (–ø—Ä—ã–∂–æ–∫)
      this.player.body.setVelocityY(-330);

      // –ú–∏–∫—Ä–æ-–∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä—ã–∂–∫–∞: –ø—Ç–∏—á–∫–∞ —Å–ª–µ–≥–∫–∞ —Å–∂–∏–º–∞–µ—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
      // –ë–µ—Ä—ë–º –±–∞–∑–æ–≤—ã–π –º–∞—Å—à—Ç–∞–± (–∑–∞–ø–æ–º–Ω–∏–ª–∏ –≤ create)
      const bx = this.playerBaseScaleX;
      const by = this.playerBaseScaleY;

      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫ –±–∞–∑–æ–≤–æ–º—É —Ä–∞–∑–º–µ—Ä—É –ø–µ—Ä–µ–¥ –∞–Ω–∏–º–∞—Ü–∏–µ–π
      // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∞ –ø—Ä–∏ –±—ã—Å—Ç—Ä—ã—Ö –Ω–∞–∂–∞—Ç–∏—è—Ö
      this.player.setScale(bx, by);

      this.tweens.add({
        targets: this.player,
        scaleX: bx * 1.1,    // —á—É—Ç—å —à–∏—Ä–µ (110%)
        scaleY: by * 0.9,    // —á—É—Ç—å –Ω–∏–∂–µ (90%)
        duration: 80,         // –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ ‚Äî 80–º—Å
        yoyo: true,           // –æ–±—Ä–∞—Ç–Ω–æ –∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É
        ease: "Quad.easeOut",
        onComplete: () => {
          // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ç–æ—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∫ –±–∞–∑–æ–≤–æ–º—É —Ä–∞–∑–º–µ—Ä—É
          this.player.setScale(bx, by);
        },
      });
      return;
    }

    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ "–ø—Ä–æ–∏–≥—Ä–∞–ª–∏" ‚Üí –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ ---
    if (this.state === "gameover") {
      // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ü–µ–Ω—É ‚Äî –≤—ã–∑–æ–≤–µ—Ç—Å—è init() ‚Üí preload() ‚Üí create()
      this.scene.restart();
    }
  }

  // ========================================
  // === –ó–ê–ü–£–°–ö –¢–ê–ô–ú–ï–†–ê –°–ü–ê–í–ù–ê –ó–î–ê–ù–ò–ô     ===
  // ========================================

  startSpawning() {
    // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî —É–¥–∞–ª—è–µ–º –µ–≥–æ
    if (this.spawnTimer) this.spawnTimer.remove(false);

    // –í—ã—á–∏—Å–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏ –∑–¥–∞–Ω–∏–π
    // –ó–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–ª–µ—Ç–µ—Ç—å –º–∏–Ω–∏–º—É–º 200 –ø–∏–∫—Å–µ–ª–µ–π –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ
    // –ò–Ω–∞—á–µ –∑–¥–∞–Ω–∏—è –±—É–¥—É—Ç —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–ª–µ—Ç–µ—Ç—å
    const minTimeBetween = (200 / this.scrollSpeed) * 1000;
    // –ë–µ—Ä—ë–º –±–æ–ª—å—à–µ–µ –∏–∑ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ
    const safeInterval = Math.max(this.spawnInterval, minTimeBetween);

    // –°–æ–∑–¥–∞—ë–º –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è —Ç–∞–π–º–µ—Ä
    this.spawnTimer = this.time.addEvent({
      delay: safeInterval,              // –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
      loop: true,                       // –ø–æ–≤—Ç–æ—Ä—è—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
      callback: this.spawnPipePair,     // –∫–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–∑—ã–≤–∞—Ç—å
      callbackScope: this,              // –∫–æ–Ω—Ç–µ–∫—Å—Ç this –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏
    });

    // –°—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë–º –ø–µ—Ä–≤—É—é –ø–∞—Ä—É (–Ω–µ –∂–¥—ë–º delay)
    this.spawnPipePair();
  }

  // ========================================
  // === –°–û–ó–î–ê–ù–ò–ï –ü–ê–†–´ –ó–î–ê–ù–ò–ô             ===
  // ========================================

  spawnPipePair() {
    // –ï—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∏–¥—ë—Ç ‚Äî –Ω–µ —Å–æ–∑–¥–∞—ë–º
    if (this.state !== "play") return;

    // –®–∏—Ä–∏–Ω–∞ –∑–¥–∞–Ω–∏—è –≤ –ø–∏–∫—Å–µ–ª—è—Ö
    const pipeW = 70;
    // –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä —â–µ–ª–∏
    const gap = this.pipeGap;
    // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∑–¥–∞–Ω–∏—è (—á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ –∏ –±—ã–ª–∏ –æ–∫–Ω–∞)
    const minPipeH = 80;

    // –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞ —â–µ–ª–∏
    // –¶–µ–Ω—Ç—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ (–∏–Ω–∞—á–µ –≤–µ—Ä—Ö–Ω–µ–µ –∑–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–µ)
    const absMin = minPipeH + gap / 2;
    // –ò –Ω–µ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–æ (–∏–Ω–∞—á–µ –Ω–∏–∂–Ω–µ–µ –∑–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–µ)
    const absMax = this.groundTop - minPipeH - gap / 2;

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Å–¥–≤–∏–≥ –û–¢–ù–û–°–ò–¢–ï–õ–¨–ù–û –ø—Ä–µ–¥—ã–¥—É—â–µ–π —â–µ–ª–∏
    // –≠—Ç–æ –≥–ª–∞–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–ø—Ä–æ—Ö–æ–¥–∏–º—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
    const lo = Math.max(absMin, this.lastGapCenter - this.maxGapShift);
    const hi = Math.min(absMax, this.lastGapCenter + this.maxGapShift);

    // –°–ª—É—á–∞–π–Ω—ã–π —Ü–µ–Ω—Ç—Ä —â–µ–ª–∏ –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    const gapCenter = Phaser.Math.Between(lo, hi);

    // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—ã–∑–æ–≤–∞
    this.lastGapCenter = gapCenter;

    // –í–µ—Ä—Ö–Ω–∏–π –∫—Ä–∞–π —â–µ–ª–∏ (–≥–¥–µ –∫–æ–Ω—á–∞–µ—Ç—Å—è –≤–µ—Ä—Ö–Ω–µ–µ –∑–¥–∞–Ω–∏–µ)
    const gapTopY = gapCenter - gap / 2;
    // –ù–∏–∂–Ω–∏–π –∫—Ä–∞–π —â–µ–ª–∏ (–≥–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∏–∂–Ω–µ–µ –∑–¥–∞–Ω–∏–µ)
    const gapBottomY = gapCenter + gap / 2;
    // X-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ ‚Äî –∑–∞ –ø—Ä–∞–≤—ã–º –∫—Ä–∞–µ–º —ç–∫—Ä–∞–Ω–∞ (–∑–¥–∞–Ω–∏–µ "–≤—ä–µ–∑–∂–∞–µ—Ç" —Å–ø—Ä–∞–≤–∞)
    const x = WIDTH + pipeW;

    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã –¥–ª—è —ç—Ç–æ–π –ø–∞—Ä—ã
    const color =
      this.buildingColors[
        Phaser.Math.Between(0, this.buildingColors.length - 1)
      ];
    // –î–µ–ª–∞–µ–º —á—É—Ç—å –±–æ–ª–µ–µ —Ç—ë–º–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫ –¥–ª—è –∫–∞—Ä–Ω–∏–∑–∞
    const darkerColor = Phaser.Display.Color.ValueToColor(color).darken(15).color;

    // ---- –í–ï–†–•–ù–ï–ï –ó–î–ê–ù–ò–ï ----
    // –°–≤–∏—Å–∞–µ—Ç –æ—Ç –ø–æ—Ç–æ–ª–∫–∞ (y=0) –¥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫—Ä–∞—è —â–µ–ª–∏ (gapTopY)
    const topH = Math.max(10, gapTopY);

    // –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –∑–¥–∞–Ω–∏—è ‚Äî –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
    const topBody = this.add.image(x, topH / 2, "px");
    topBody.setTint(color);                    // —Ü–≤–µ—Ç –∑–¥–∞–Ω–∏—è
    topBody.setDisplaySize(pipeW, topH);       // —Ä–∞–∑–º–µ—Ä
    topBody.setDepth(3);                       // —Å–ª–æ–π ‚Äî –Ω–∞–¥ —Ñ–æ–Ω–æ–º, –ø–æ–¥ –∑–µ–º–ª—ë–π

    // –ö–∞—Ä–Ω–∏–∑ (–≤—ã—Å—Ç—É–ø) –≤–Ω–∏–∑—É –≤–µ—Ä—Ö–Ω–µ–≥–æ –∑–¥–∞–Ω–∏—è ‚Äî —á—É—Ç—å —à–∏—Ä–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞
    const topLedge = this.add.image(x, topH - 2, "px");
    topLedge.setTint(darkerColor);             // —Ç–µ–º–Ω–µ–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
    topLedge.setDisplaySize(pipeW + 8, 10);    // —à–∏—Ä–µ –Ω–∞ 8px, –≤—ã—Å–æ—Ç–∞ 10px
    topLedge.setDepth(3);

    // –û–∫–Ω–∞ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º –∑–¥–∞–Ω–∏–∏
    const topWindows = this.createWindows(x, 0, pipeW, topH);

    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —á–∞—Å—Ç–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∑–¥–∞–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤
    const topGroup = [topBody, topLedge, ...topWindows];

    // –°–æ–∑–¥–∞—ë–º –º–∞—Ä–∫–µ—Ä ‚Äî –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –∫–æ–ª–ª–∏–∑–∏–π –∏ –¥–≤–∏–∂–µ–Ω–∏—è
    const topMarker = {
      x: x,                    // —Ç–µ–∫—É—â–∞—è X-–ø–æ–∑–∏—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞
      y: topH / 2,             // Y-–ø–æ–∑–∏—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π)
      pipeW: pipeW + 8,        // —à–∏—Ä–∏–Ω–∞ —Å —É—á—ë—Ç–æ–º –∫–∞—Ä–Ω–∏–∑–∞
      pipeH: topH,             // –≤—ã—Å–æ—Ç–∞
      scored: false,            // –æ—á–∫–æ –∑–∞ —ç—Ç—É –ø–∞—Ä—É –µ—â—ë –Ω–µ –∑–∞—Å—á–∏—Ç–∞–Ω–æ
      parts: topGroup,          // –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —á–∞—Å—Ç–µ–π
    };

    // ---- –ù–ò–ñ–ù–ï–ï –ó–î–ê–ù–ò–ï ----
    // –°—Ç–æ–∏—Ç –æ—Ç –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è —â–µ–ª–∏ (gapBottomY) –¥–æ –∑–µ–º–ª–∏
    const bottomH = Math.max(10, this.groundTop - gapBottomY);

    // –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫
    const botBody = this.add.image(x, gapBottomY + bottomH / 2, "px");
    botBody.setTint(color);
    botBody.setDisplaySize(pipeW, bottomH);
    botBody.setDepth(3);

    // –ö–∞—Ä–Ω–∏–∑ —Å–≤–µ—Ä—Ö—É –Ω–∏–∂–Ω–µ–≥–æ –∑–¥–∞–Ω–∏—è
    const botLedge = this.add.image(x, gapBottomY + 2, "px");
    botLedge.setTint(darkerColor);
    botLedge.setDisplaySize(pipeW + 8, 10);
    botLedge.setDepth(3);

    // –û–∫–Ω–∞ –Ω–∞ –Ω–∏–∂–Ω–µ–º –∑–¥–∞–Ω–∏–∏
    const botWindows = this.createWindows(x, gapBottomY, pipeW, bottomH);

    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —á–∞—Å—Ç–∏
    const botGroup = [botBody, botLedge, ...botWindows];

    // –ú–∞—Ä–∫–µ—Ä –Ω–∏–∂–Ω–µ–≥–æ –∑–¥–∞–Ω–∏—è (–±–µ–∑ scored ‚Äî –æ—á–∫–æ —Å—á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É)
    const botMarker = {
      x: x,
      y: gapBottomY + bottomH / 2,
      pipeW: pipeW + 8,
      pipeH: bottomH,
      parts: botGroup,
    };

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–∞ –º–∞—Ä–∫–µ—Ä–∞ –≤ –º–∞—Å—Å–∏–≤
    this.pipeMarkers.push(topMarker);
    this.pipeMarkers.push(botMarker);
  }

  // ========================================
  // === –°–û–ó–î–ê–ù–ò–ï –û–ö–û–ù –ù–ê –ó–î–ê–ù–ò–ò          ===
  // ========================================

  // centerX ‚Äî X-—Ü–µ–Ω—Ç—Ä –∑–¥–∞–Ω–∏—è
  // topY    ‚Äî Y –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫—Ä–∞—è –∑–¥–∞–Ω–∏—è
  // buildW  ‚Äî —à–∏—Ä–∏–Ω–∞ –∑–¥–∞–Ω–∏—è
  // buildH  ‚Äî –≤—ã—Å–æ—Ç–∞ –∑–¥–∞–Ω–∏—è
  createWindows(centerX, topY, buildW, buildH) {
    // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –æ–∫–æ–Ω
    const windows = [];
    // –†–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ –æ–∫–Ω–∞
    const winW = 8;   // —à–∏—Ä–∏–Ω–∞
    const winH = 10;  // –≤—ã—Å–æ—Ç–∞
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –æ–∫–æ–Ω
    const cols = 3;
    // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ (—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ —à–∏—Ä–∏–Ω–µ)
    const spacingX = buildW / (cols + 1);
    // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ä—è–¥–∞–º–∏ –æ–∫–æ–Ω
    const spacingY = 28;
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ ‚Äî —Å–∫–æ–ª—å–∫–æ –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –ø–æ –≤—ã—Å–æ—Ç–µ
    const rows = Math.floor((buildH - 20) / spacingY);

    // –°–æ–∑–¥–∞—ë–º —Å–µ—Ç–∫—É –æ–∫–æ–Ω
    for (let row = 0; row < rows; row++) {
      for (let col = 0; col < cols; col++) {
        // –ü–æ–∑–∏—Ü–∏—è –æ–∫–Ω–∞ –ø–æ X (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ –∑–¥–∞–Ω–∏—è)
        const wx = centerX - buildW / 2 + spacingX * (col + 1);
        // –ü–æ–∑–∏—Ü–∏—è –æ–∫–Ω–∞ –ø–æ Y (–æ—Ç –≤–µ—Ä—Ö–∞ –∑–¥–∞–Ω–∏—è –≤–Ω–∏–∑)
        const wy = topY + 15 + row * spacingY;

        // –°–ª—É—á–∞–π–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º ‚Äî –≥–æ—Ä–∏—Ç –ª–∏ —Å–≤–µ—Ç –≤ –æ–∫–Ω–µ
        const isLit = Math.random() > 0.4; // 60% —à–∞–Ω—Å —á—Ç–æ –≥–æ—Ä–∏—Ç
        // –ì–æ—Ä—è—â–µ–µ –æ–∫–Ω–æ ‚Äî —Ç—ë–ø–ª—ã–π –∂—ë–ª—Ç—ã–π, –ø–æ—Ç—É—à–µ–Ω–Ω–æ–µ ‚Äî —Ç—ë–º–Ω–æ–µ
        const winColor = isLit ? 0xfff3b0 : 0x2a2a3a;
        // –ì–æ—Ä—è—â–µ–µ –æ–∫–Ω–æ —è—Ä—á–µ
        const winAlpha = isLit ? 0.9 : 0.5;

        // –°–æ–∑–¥–∞—ë–º –æ–∫–Ω–æ
        const win = this.add.image(wx, wy, "px");
        win.setTint(winColor);
        win.setDisplaySize(winW, winH);
        win.setAlpha(winAlpha);
        win.setDepth(4); // —á—É—Ç—å –≤—ã—à–µ —Å—Ç–µ–Ω—ã –∑–¥–∞–Ω–∏—è

        windows.push(win);
      }
    }
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –æ–∫–æ–Ω ‚Äî –æ–Ω–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ parts –º–∞—Ä–∫–µ—Ä–∞
    return windows;
  }

  // ========================================
  // === –°–ú–ï–†–¢–¨ –ò–ì–†–û–ö–ê                    ===
  // ========================================

  die() {
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ (–º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è –µ—Å–ª–∏
    // –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å–æ –∑–¥–∞–Ω–∏–µ–º –∏ –∑–µ–º–ª—ë–π)
    if (this.state === "gameover") return;
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    this.state = "gameover";

    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –µ—â—ë –∏–¥—ë—Ç
    if (this.idleTween) {
      this.idleTween.stop();
      this.idleTween = null;
    }

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ç–∏—á–∫—É –∫ –±–∞–∑–æ–≤–æ–º—É –º–∞—Å—à—Ç–∞–±—É
    // (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —É–º–µ—Ä–ª–∏ –≤–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä—ã–∂–∫–∞)
    this.player.setScale(this.playerBaseScaleX, this.playerBaseScaleY);

    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ç–∏—á–∫—É
    this.player.body.setVelocity(0, 0);
    // –û—Ç–∫–ª—é—á–∞–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é (—á—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞–ª–∞ –¥–∞–ª—å—à–µ)
    this.player.body.setAllowGravity(false);

    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∑–¥–∞–Ω–∏–π
    if (this.spawnTimer) this.spawnTimer.remove(false);

    // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã —Å–º–µ—Ä—Ç–∏
    // –ö—Ä–∞—Å–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ —ç–∫—Ä–∞–Ω–∞ (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, R, G, B)
    this.cameras.main.flash(200, 255, 100, 100);
    // –¢—Ä—è—Å–∫–∞ –∫–∞–º–µ—Ä—ã (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å)
    this.cameras.main.shake(300, 0.015);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º ‚Äî –ø–æ–±–∏—Ç –ª–∏ —Ä–µ–∫–æ—Ä–¥
    let isNewRecord = false;
    if (this.score > this.bestScore) {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥ –≤ –ø–∞–º—è—Ç–∏
      this.bestScore = this.score;
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage ‚Äî –ø–µ—Ä–µ–∂–∏–≤—ë—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
      localStorage.setItem("flappy-best", String(this.bestScore));
      isNewRecord = true;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Ä–µ–∫–æ—Ä–¥–∞ –≤–≤–µ—Ä—Ö—É —ç–∫—Ä–∞–Ω–∞
    this.bestText.setText("–†–µ–∫–æ—Ä–¥: " + this.bestScore);
    // –ü—Ä—è—á–µ–º —Ç–µ–∫—É—â–∏–π —Å—á—ë—Ç (–æ–Ω –±—É–¥–µ—Ç –Ω–∞ –ø–∞–Ω–µ–ª–∏)
    this.scoreText.setVisible(false);

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–∞–Ω–µ–ª—å –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –¥–∞–Ω–Ω—ã–º–∏
    this.panelScoreText.setText("–°—á—ë—Ç: " + this.score);
    this.panelBestText.setText("–†–µ–∫–æ—Ä–¥: " + this.bestScore);
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!" —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–±–∏–ª–∏
    this.newRecordText.setVisible(isNewRecord);

    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ (fade in)
    this.gameOverPanel.setVisible(true);
    this.gameOverPanel.setAlpha(0); // –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø–æ–ª–Ω–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
    this.tweens.add({
      targets: this.gameOverPanel,
      alpha: 1,              // –ø–ª–∞–≤–Ω–æ –¥–æ –ø–æ–ª–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
      duration: 400,         // –∑–∞ 400–º—Å
      ease: "Quad.easeOut",  // —Å –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ–º –≤ –∫–æ–Ω—Ü–µ
    });

    // –ï—Å–ª–∏ –Ω–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥ ‚Äî –ø—É–ª—å—Å–∞—Ü–∏—è –Ω–∞–¥–ø–∏—Å–∏
    if (isNewRecord) {
      this.tweens.add({
        targets: this.newRecordText,
        scaleX: 1.15,        // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞ 15%
        scaleY: 1.15,
        duration: 500,
        yoyo: true,          // –æ–±—Ä–∞—Ç–Ω–æ
        repeat: -1,          // –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
        ease: "Sine.easeInOut",
      });
    }

    // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
    // === –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö –î–õ–Ø –ü–û–î–°–ö–ê–ó–ö–ò ===

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
if (this.hintText) {
  this.hintText.destroy();
  this.hintText = null;
}

// –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç —Å –Ω—É–ª—è
// –í –º–µ—Ç–æ–¥–µ die(), –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è hintText:

this.hintText = this.add.text(
  WIDTH / 2, 
  HEIGHT / 2 + 80, 
  "–ù–∞–∂–º–∏ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞", 
  {
    fontFamily: "Arial",
    fontSize: "22px",
    color: "#ffd93d",
    stroke: "#000000",
    strokeThickness: 3,
    // backgroundColor: "#ff0000",  // –ö–†–ê–°–ù–´–ô –§–û–ù - –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞!
    padding: { x: 10, y: 5 }
  }
);

this.hintText.setOrigin(0.5);
this.hintText.setDepth(200);     // –ü–æ–¥–Ω—è–ª–∏ –µ—â—ë –≤—ã—à–µ!
this.hintText.setVisible(true);
this.hintText.setAlpha(1);     // –Ø–í–ù–û –ø–æ–ª–Ω–∞—è –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å

// –ê–Ω–∏–º–∞—Ü–∏—è –º–∏–≥–∞–Ω–∏—è
this.tweens.add({
  targets: this.hintText,
  alpha: 0.4,
  duration: 800,
  yoyo: true,
  repeat: -1,
  ease: "Sine.easeInOut",
});

// // –û–¢–õ–ê–î–ö–ê - –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ:
// console.log("hintText —Å–æ–∑–¥–∞–Ω:", this.hintText.text, "visible:", this.hintText.visible);
  }

  // ========================================
  // === –î–û–ë–ê–í–õ–ï–ù–ò–ï –û–ß–ö–ê                  ===
  // ========================================

  addScore() {
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç –Ω–∞ 1
    this.score += 1;
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    this.scoreText.setText(String(this.score));

    // –ê–Ω–∏–º–∞—Ü–∏—è ‚Äî —Ü–∏—Ñ—Ä–∞ —Å—á—ë—Ç–∞ –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–µ—Ç
    this.tweens.add({
      targets: this.scoreText,
      scaleX: 1.3,           // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞ 30%
      scaleY: 1.3,
      duration: 100,         // –±—ã—Å—Ç—Ä–æ ‚Äî 100–º—Å
      yoyo: true,            // –æ–±—Ä–∞—Ç–Ω–æ
      ease: "Quad.easeOut",
    });

    // –ö–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤ ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
    if (this.score % 5 === 0) {
      // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å (–º–∞–∫—Å–∏–º—É–º 280 –ø–∏–∫—Å/—Å–µ–∫)
      this.scrollSpeed = Math.min(280, this.scrollSpeed + 12);

      // –í—ã—á–∏—Å–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–æ–ø—É—Å—Ç–∏–º—É—é —â–µ–ª—å
      // –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ —Ö–∏—Ç–±–æ–∫—Å–∞ –ø—Ç–∏—Ü—ã + –∑–∞–ø–∞—Å —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω
      const minGapByBird = this.player.body.height + this.gapPadding * 2;
      // –ñ—ë—Å—Ç–∫–∏–π –º–∏–Ω–∏–º—É–º ‚Äî –Ω–µ –º–µ–Ω—å—à–µ 110px –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
      const minGapHard = 110;
      // –£–º–µ–Ω—å—à–∞–µ–º —â–µ–ª—å –Ω–∞ 6px, –Ω–æ –Ω–µ –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º—É–º–æ–≤
      this.pipeGap = Math.max(minGapHard, minGapByBird, this.pipeGap - 6);

      // –£–º–µ–Ω—å—à–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–ø–∞–≤–Ω–∞ (–º–∏–Ω–∏–º—É–º 950–º—Å)
      this.spawnInterval = Math.max(950, this.spawnInterval - 30);

      // –£–º–µ–Ω—å—à–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–¥–≤–∏–≥ —â–µ–ª–∏ (–º–∏–Ω–∏–º—É–º 80px)
      // –ù–∞ –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ —â–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–ª–∏–∂–µ –ø–æ –≤—ã—Å–æ—Ç–µ
      this.maxGapShift = Math.max(80, this.maxGapShift - 5);

      // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
      this.startSpawning();
    }
  }

  // ========================================
  // === –ü–†–û–í–ï–†–ö–ê –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–Ø (AABB)     ===
  // ========================================

  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –ª–∏ –¥–≤–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
  // a ‚Äî –ø–µ—Ä–≤—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (ax, ay = —Ü–µ–Ω—Ç—Ä; aw, ah = —Ä–∞–∑–º–µ—Ä—ã)
  // b ‚Äî –≤—Ç–æ—Ä–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (bx, by = —Ü–µ–Ω—Ç—Ä; bw, bh = —Ä–∞–∑–º–µ—Ä—ã)
  rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
    return (
      ax - aw / 2 < bx + bw / 2 && // –ª–µ–≤—ã–π –∫—Ä–∞–π A –ª–µ–≤–µ–µ –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—è B
      ax + aw / 2 > bx - bw / 2 && // –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π A –ø—Ä–∞–≤–µ–µ –ª–µ–≤–æ–≥–æ –∫—Ä–∞—è B
      ay - ah / 2 < by + bh / 2 && // –≤–µ—Ä—Ö A –≤—ã—à–µ –Ω–∏–∑–∞ B
      ay + ah / 2 > by - bh / 2    // –Ω–∏–∑ A –Ω–∏–∂–µ –≤–µ—Ä—Ö–∞ B
    );
    // –ï—Å–ª–∏ –í–°–ï 4 —É—Å–ª–æ–≤–∏—è true ‚Äî –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è
  }

  // ========================================
  // === –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ –û–ë–ù–û–í–õ–ï–ù–ò–Ø         ===
  // ========================================

  // update() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä (~60 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É)
  // time  ‚Äî –æ–±—â–µ–µ –≤—Ä–µ–º—è —Å –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã (–º—Å)
  // delta ‚Äî –≤—Ä–µ–º—è —Å –ø—Ä–æ—à–ª–æ–≥–æ –∫–∞–¥—Ä–∞ (–º—Å), –æ–±—ã—á–Ω–æ ~16.6–º—Å
  update(time, delta) {
    // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω ‚Äî –≤—ã—Ö–æ–¥–∏–º
    if (!this.player || !this.player.body) return;

    // ---- –û–ë–õ–ê–ö–ê –î–í–ò–ì–ê–Æ–¢–°–Ø –í–°–ï–ì–î–ê (–¥–∞–∂–µ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ) ----
    for (const cloud of this.clouds) {
      // –î–≤–∏–≥–∞–µ–º –æ–±–ª–∞–∫–æ –≤–ª–µ–≤–æ —Å –µ–≥–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é
      cloud.x -= cloud.cloudSpeed * (delta / 1000);
      // –ï—Å–ª–∏ –æ–±–ª–∞–∫–æ —É—à–ª–æ –∑–∞ –ª–µ–≤—ã–π –∫—Ä–∞–π ‚Äî –ø–µ—Ä–µ–º–µ—â–∞–µ–º –Ω–∞–ø—Ä–∞–≤–æ
      if (cloud.x < -60) {
        cloud.x = WIDTH + 60;
        // –ù–æ–≤–∞—è —Å–ª—É—á–∞–π–Ω–∞—è –≤—ã—Å–æ—Ç–∞
        cloud.y = Phaser.Math.Between(30, HEIGHT / 2 - 50);
      }
    }

    // ---- –¢–ï–ù–¨ –ü–û–î –ü–¢–ò–ß–ö–û–ô ----
    if (this.playerShadow) {
      // –¢–µ–Ω—å —Å–ª–µ–¥—É–µ—Ç –∑–∞ –ø—Ç–∏—á–∫–æ–π –ø–æ X
      this.playerShadow.x = this.player.x;
      // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –ø—Ç–∏—á–∫–∏ –¥–æ –∑–µ–º–ª–∏
      const dist = this.groundTop - this.player.y;
      // –ß–µ–º –≤—ã—à–µ –ø—Ç–∏—á–∫–∞ ‚Äî —Ç–µ–º –º–µ–Ω—å—à–µ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ —Ç–µ–Ω—å
      const shadowScale = Phaser.Math.Clamp(1 - dist / 500, 0.3, 1);
      this.playerShadow.setDisplaySize(40 * shadowScale, 8 * shadowScale);
      this.playerShadow.setAlpha(0.15 * shadowScale);
    }

    // –í —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è ‚Äî –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º
    if (this.state === "idle") return;
    // –ü–æ—Å–ª–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞ ‚Äî —Ç–æ–∂–µ
    if (this.state === "gameover") return;
    // ---- –ê–í–¢–û–ü–õ–ï–ô –ë–û–¢ ----
if (window.bot?.enabled && this.state === "play") {
  let shouldJump = false;
  
  // –ï—Å–ª–∏ –ø–∞–¥–∞–µ–º –∏ –Ω–∏–∂–µ —Å–µ—Ä–µ–¥–∏–Ω—ã ‚Äî –ø—Ä—ã–≥–∞–µ–º
  if (this.player.body.velocity.y > 0 && this.player.y > HEIGHT / 2) {
    shouldJump = true;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–∏–∂–∞–π—à–µ–µ –∑–¥–∞–Ω–∏–µ
  for (const marker of this.pipeMarkers) {
    if (marker.scored === undefined) continue;
    
    if (marker.x > this.player.x - 50 && marker.x < this.player.x + 150) {
      const gapCenter = marker.y + marker.pipeH / 2 + this.pipeGap / 2;
      if (this.player.y > gapCenter + 20) {
        shouldJump = true;
      }
      break;
    }
  }
  
  if (shouldJump) {
    this.player.body.setVelocityY(-330);
  }
}

    // ---- –ù–ê–ö–õ–û–ù –ü–¢–ò–ß–ö–ò ----
    // –ë–µ—Ä—ë–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å
    const vy = this.player.body.velocity.y;
    // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º: –≤–≤–µ—Ä—Ö –ø—Ä–∏ –ø–æ–¥—ä—ë–º–µ (-0.5 —Ä–∞–¥), –≤–Ω–∏–∑ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ (0.8 —Ä–∞–¥)
    this.player.rotation = Phaser.Math.Clamp(vy / 600, -0.5, 0.8);

    // ---- –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï –°–í–ï–†–•–£ ----
    // –ù–µ –¥–∞—ë–º –ø—Ç–∏—á–∫–µ —É–ª–µ—Ç–µ—Ç—å –∑–∞ –≤–µ—Ä—Ö–Ω–∏–π –∫—Ä–∞–π
    if (this.player.y < 0) {
      this.player.y = 0;
      this.player.body.setVelocityY(0);
    }

    // ---- –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–ï –° –ó–ï–ú–õ–Å–ô ----
    // –ï—Å–ª–∏ –Ω–∏–∂–Ω–∏–π –∫—Ä–∞–π —Ö–∏—Ç–±–æ–∫—Å–∞ –¥–æ—Å—Ç–∏–≥ –∑–µ–º–ª–∏
    if (this.player.body.bottom >= this.groundTop) {
      this.die();
      return; // –≤—ã—Ö–æ–¥–∏–º ‚Äî –¥–∞–ª—å—à–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
    }

    // ---- –î–í–ò–ñ–ï–ù–ò–ï –ó–î–ê–ù–ò–ô ----
    // –°–∫–æ–ª—å–∫–æ –ø–∏–∫—Å–µ–ª–µ–π —Å–¥–≤–∏–Ω—É—Ç—å –∑–∞ —ç—Ç–æ—Ç –∫–∞–¥—Ä
    // scrollSpeed ‚Äî –ø–∏–∫—Å–µ–ª–µ–π –≤ —Å–µ–∫—É–Ω–¥—É, delta ‚Äî –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
    const speed = this.scrollSpeed * (delta / 1000);

    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ —Ä–∞–∑–º–µ—Ä —Ö–∏—Ç–±–æ–∫—Å–∞ –∏–≥—Ä–æ–∫–∞
    const px = this.player.body.center.x;  // —Ü–µ–Ω—Ç—Ä –ø–æ X
    const py = this.player.body.center.y;  // —Ü–µ–Ω—Ç—Ä –ø–æ Y
    const pw = this.player.body.width;     // —à–∏—Ä–∏–Ω–∞ —Ö–∏—Ç–±–æ–∫—Å–∞
    const ph = this.player.body.height;    // –≤—ã—Å–æ—Ç–∞ —Ö–∏—Ç–±–æ–∫—Å–∞

    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –º–∞—Ä–∫–µ—Ä–∞–º –∑–¥–∞–Ω–∏–π (—Å –∫–æ–Ω—Ü–∞ ‚Äî –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è)
    for (let i = this.pipeMarkers.length - 1; i >= 0; i--) {
      const marker = this.pipeMarkers[i];

      // –û–±–Ω–æ–≤–ª—è–µ–º X-–ø–æ–∑–∏—Ü–∏—é –º–∞—Ä–∫–µ—Ä–∞
      marker.x -= speed;

      // –î–≤–∏–≥–∞–µ–º –í–°–ï –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏ –∑–¥–∞–Ω–∏—è (—Å—Ç–µ–Ω–∞, –∫–∞—Ä–Ω–∏–∑, –æ–∫–Ω–∞)
      for (const part of marker.parts) {
        part.x -= speed;
      }

      // –ï—Å–ª–∏ –∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—à–ª–æ –∑–∞ –ª–µ–≤—ã–π –∫—Ä–∞–π ‚Äî —É–¥–∞–ª—è–µ–º
      if (marker.x + marker.pipeW / 2 < -80) {
        // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –≤—Å–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
        for (const part of marker.parts) {
          part.destroy();
        }
        // –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –∏–∑ –º–∞—Å—Å–∏–≤–∞
        this.pipeMarkers.splice(i, 1);
        continue; // –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
      }

      // ---- –ü–†–û–í–ï–†–ö–ê –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–Ø ----
      if (
        this.rectsOverlap(
          px, py, pw, ph,                              // —Ö–∏—Ç–±–æ–∫—Å –∏–≥—Ä–æ–∫–∞
          marker.x, marker.y, marker.pipeW, marker.pipeH // —Ö–∏—Ç–±–æ–∫—Å –∑–¥–∞–Ω–∏—è
        )
      ) {
        this.die();
        return; // –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞
      }

      // ---- –ü–û–î–°–ß–Å–¢ –û–ß–ö–û–í ----
      // scored –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —É –≤–µ—Ä—Ö–Ω–µ–≥–æ –º–∞—Ä–∫–µ—Ä–∞ (—á—Ç–æ–±—ã –Ω–µ —Å—á–∏—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã)
      if (marker.scored !== undefined && !marker.scored) {
        // –ï—Å–ª–∏ –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π –∑–¥–∞–Ω–∏—è –ø—Ä–æ—à—ë–ª –ª–µ–≤—ã–π –∫—Ä–∞–π –ø—Ç–∏—á–∫–∏
        if (marker.x + marker.pipeW / 2 < px - pw / 2) {
          marker.scored = true; // –æ—Ç–º–µ—á–∞–µ–º ‚Äî –æ—á–∫–æ –∑–∞—Å—á–∏—Ç–∞–Ω–æ
          this.addScore();      // +1 –æ—á–∫–æ
        }
      }
    }
  }
}

// ========================================
// === –ó–ê–ü–£–°–ö –ò–ì–†–´                      ===
// ========================================

// –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä Phaser.Game ‚Äî —ç—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å—ë
new Phaser.Game({
  type: Phaser.AUTO,           // –∞–≤—Ç–æ–≤—ã–±–æ—Ä —Ä–µ–Ω–¥–µ—Ä–∞: WebGL –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏–Ω–∞—á–µ Canvas
  width: WIDTH,                // —à–∏—Ä–∏–Ω–∞ –∏–≥—Ä—ã
  height: HEIGHT,              // –≤—ã—Å–æ—Ç–∞ –∏–≥—Ä—ã
  parent: "app",               // ID HTML-—ç–ª–µ–º–µ–Ω—Ç–∞ –∫—É–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—å canvas
  physics: {
    default: "arcade",         // –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—É—é –∞—Ä–∫–∞–¥–Ω—É—é —Ñ–∏–∑–∏–∫—É
    arcade: {
      gravity: { y: 0 },      // –≥–ª–æ–±–∞–ª—å–Ω–∞—è –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞
      debug: false,            // true ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–∏—Ç–±–æ–∫—Å—ã (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
    },
  },
  scene: [GameScene],          // –º–∞—Å—Å–∏–≤ —Å—Ü–µ–Ω (—É –Ω–∞—Å –æ–¥–Ω–∞)
  scale: {
    mode: Phaser.Scale.FIT,    // –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞
    autoCenter: Phaser.Scale.CENTER_BOTH, // —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ –æ–±–µ–∏–º –æ—Å—è–º
  },
});